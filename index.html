<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Celeste Avant â€“ Stocks</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: #000;
      color: #fff;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .stock-card {
      background: #111;
      padding: 16px;
      margin: 12px 0;
      border-radius: 16px;
      width: 100%;
      max-width: 380px;
      box-shadow: 0 2px 10px rgba(255,255,255,0.05);
    }
    .stock-header {
      display: flex;
      justify-content: space-between;
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 8px;
    }
    .change.green { color: #00FF66; }
    .change.red { color: #FF3C38; }
    canvas { height: 60px !important; width: 100% !important; }
  </style>
</head>
<body>
  <h2 style="font-weight: 600; margin-bottom: 20px;">Market Overview</h2>

  <div id="stock-container"></div>

  <script>
    const API_KEY = '4f0e94fbae72478282b8789831a26606'; // your real API key
    const symbols = [
      { label: 'S&P 500', symbol: 'SPY', color: '#00FF66' },
      { label: 'NASDAQ', symbol: 'QQQ', color: '#FF3C38' },
      { label: 'DOW', symbol: 'DIA', color: '#00D1FF' }
    ];

    const container = document.getElementById('stock-container');

    function createCard(symbolInfo) {
      const div = document.createElement('div');
      div.className = 'stock-card';
      div.innerHTML = `
        <div class="stock-header">
          <span>${symbolInfo.label}</span>
          <span id="${symbolInfo.symbol}-change" class="change">Loading...</span>
        </div>
        <canvas id="${symbolInfo.symbol}-chart"></canvas>
      `;
      return div;
    }

    async function fetchStock(symbol) {
      const url = `https://api.twelvedata.com/time_series?symbol=${symbol}&interval=5min&outputsize=78&apikey=${API_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      if (!data || !data.values) return null;
      const closes = data.values.map(point => parseFloat(point.close)).reverse();
      const change = ((closes.at(-1) - closes[0]) / closes[0]) * 100;
      return { closes, change };
    }

    function drawLineChart(canvasId, data, color) {
      const ctx = document.getElementById(canvasId).getContext('2d');
      return new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.map((_, i) => i),
          datasets: [{
            data,
            borderColor: color,
            tension: 0.3,
            borderWidth: 2,
            pointRadius: 0,
            fill: false
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: {
            x: { display: false },
            y: { display: false }
          }
        }
      });
    }

    async function buildWidget() {
      container.innerHTML = '';
      for (const sym of symbols) {
        const card = createCard(sym);
        container.appendChild(card);
        const result = await fetchStock(sym.symbol);
        if (result) {
          const { closes, change } = result;
          const changeElem = document.getElementById(`${sym.symbol}-change`);
          changeElem.textContent = `${change > 0 ? '+' : ''}${change.toFixed(2)}%`;
          changeElem.classList.add(change >= 0 ? 'green' : 'red');
          drawLineChart(`${sym.symbol}-chart`, closes, sym.color);
        } else {
          document.getElementById(`${sym.symbol}-change`).textContent = 'Error';
        }
      }
    }

    buildWidget();
    setInterval(buildWidget, 300000); // update every 5 minutes
  </script>
</body>
</html>


